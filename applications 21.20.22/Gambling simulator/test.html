<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fake Gambling Simulator</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #f5f5f5;
        color: #222;
        margin: 0;
        padding: 20px;
      }
      .container {
        max-width: 900px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      h1 {
        text-align: center;
      }
      .section {
        border: 1px solid #ddd;
        padding: 10px;
        border-radius: 8px;
        margin-bottom: 15px;
      }
      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: pointer;
        margin: 4px;
      }
      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      input {
        padding: 5px;
        width: 100px;
      }
      .result {
        background: #f0f0f0;
        padding: 10px;
        border-radius: 8px;
        font-size: 14px;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Fake Gambling Simulator</h1>
      <p>
        <b>Note:</b> This is a local-only fake simulator. No real money
        involved.
      </p>

      <div class="section">
        <h2>Player Info</h2>
        <div id="info"></div>
        <label>Bet: <input type="number" id="bet" value="10" /></label>
        <button onclick="resetSave()">Reset Save</button>
      </div>

      <div class="section">
        <h2>Plinko</h2>
        <button onclick="playPlinko()">Play Plinko</button>
        <div id="plinko-result"></div>
      </div>

      <div class="section">
        <h2>Bombs (Minefield)</h2>
        <button onclick="playBombs(3,3)">Open 3</button>
        <button onclick="playBombs(6,3)">Open 6</button>
        <button onclick="playBombs(9,3)">Open 9</button>
        <div id="bombs-result"></div>
      </div>

      <div class="section">
        <h2>Slots</h2>
        <button onclick="playSlots()">Spin Slots</button>
        <div id="slots-result"></div>
      </div>

      <div class="section">
        <h2>Save Management</h2>
        <button onclick="exportSave()">Export Save</button>
        <input
          type="file"
          id="importFile"
          accept="application/json"
          onchange="importSave(event)"
        />
      </div>

      <div class="result" id="message"></div>
    </div>

    <script>
      const STORAGE_KEY = "playerSave";

      const DEFAULT_PLAYER = {
        balance: 1000,
        amountOfTimesGambled: 0,
        totalMoneyGambled: 0,
        totalMoneyWonOnGambling: 0,
        totalEarned: 0,
      };

      function loadPlayer() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          return raw
            ? { ...DEFAULT_PLAYER, ...JSON.parse(raw) }
            : { ...DEFAULT_PLAYER };
        } catch {
          return { ...DEFAULT_PLAYER };
        }
      }

      function savePlayer() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(player));
      }

      let player = loadPlayer();

      function updateInfo() {
        document.getElementById("info").innerHTML = `
        Balance: ${player.balance.toFixed(2)}<br>
        Gambles: ${player.amountOfTimesGambled}<br>
        Total Gambled: ${player.totalMoneyGambled.toFixed(2)}<br>
        Total Won: ${player.totalMoneyWonOnGambling.toFixed(2)}
      `;
      }

      function message(text) {
        document.getElementById("message").innerText = text;
      }

      function applyResult(delta, gambled) {
        player.balance = Math.max(0, player.balance + delta);
        player.amountOfTimesGambled++;
        player.totalMoneyGambled += gambled;
        if (delta > 0) player.totalMoneyWonOnGambling += delta;
        player.totalEarned += Math.max(0, delta);
        savePlayer();
        updateInfo();
      }

      // ---- Plinko ----
      async function playPlinko() {
        const bet = Number(document.getElementById("bet").value);
        if (bet <= 0 || bet > player.balance) return message("Invalid bet");

        const rows = 8;
        const slots = rows + 1;
        const payouts = Array.from({ length: slots }, (_, i) => {
          const c = (slots - 1) / 2;
          const d = Math.abs(i - c);
          return +(0.25 + (Math.max(0, c - d) * 0.75) / c).toFixed(2);
        });

        let position = Math.floor(slots / 2);
        for (let i = 0; i < rows; i++) {
          position = Math.max(
            0,
            Math.min(slots - 1, position + (Math.random() < 0.5 ? -1 : 1)),
          );
          await new Promise((r) => setTimeout(r, 100));
        }
        const multiplier = payouts[position];
        const payout = +(bet * multiplier).toFixed(2);
        const net = payout - bet;
        applyResult(net, bet);
        document.getElementById("plinko-result").innerText =
          `Slot ${position}, Multiplier ${multiplier}x, Payout ${payout} (Net ${net.toFixed(2)})`;
        message("Plinko done!");
      }

      // ---- Bombs ----
      function computeBombsPayout(choices, bombs) {
        let multiplier = 0;
        for (let i = 0; i < choices; i++) {
          const safeChance = (12 - bombs - i) / (12 - i);
          multiplier += 1 / safeChance;
        }
        return +(multiplier * 0.15).toFixed(2);
      }

      async function playBombs(choices, bombs) {
        const bet = Number(document.getElementById("bet").value);
        if (bet <= 0 || bet > player.balance) return message("Invalid bet");
        const bombPositions = new Set();
        while (bombPositions.size < bombs)
          bombPositions.add(Math.floor(Math.random() * 12));

        let hitBomb = false;
        for (let i = 0; i < choices; i++) {
          if (bombPositions.has(Math.floor(Math.random() * 12))) {
            hitBomb = true;
            applyResult(-bet, bet);
            document.getElementById("bombs-result").innerText =
              "Hit a bomb! Lost your bet.";
            return;
          }
          await new Promise((r) => setTimeout(r, 200));
        }

        const mult = computeBombsPayout(choices, bombs);
        const payout = bet * mult;
        const net = payout - bet;
        applyResult(net, bet);
        document.getElementById("bombs-result").innerText =
          `Cleared ${choices} boxes! Multiplier ${mult}x, Payout ${payout}`;
        message("Bombs game done!");
      }

      // ---- Slots ----
      const symbols = [
        { id: "ðŸ’", weight: 40, payout: 1 },
        { id: "ðŸ””", weight: 25, payout: 2 },
        { id: "ðŸ‹", weight: 20, payout: 3 },
        { id: "â­", weight: 10, payout: 5 },
        { id: "7ï¸âƒ£", weight: 5, payout: 10 },
      ];

      function weightedPick(weights) {
        const sum = weights.reduce((a, b) => a + b, 0);
        let r = Math.random() * sum;
        for (let i = 0; i < weights.length; i++) {
          if (r < weights[i]) return i;
          r -= weights[i];
        }
        return weights.length - 1;
      }

      async function playSlots() {
        const bet = Number(document.getElementById("bet").value);
        if (bet <= 0 || bet > player.balance) return message("Invalid bet");

        const weights = symbols.map((s) => s.weight);
        const results = [];
        for (let i = 0; i < 3; i++) {
          await new Promise((r) => setTimeout(r, 150));
          results.push(symbols[weightedPick(weights)]);
        }
        let payout = 0;
        if (
          results[0].id === results[1].id &&
          results[1].id === results[2].id
        ) {
          payout = bet * results[0].payout * 2;
        } else if (
          results[0].id === results[1].id ||
          results[1].id === results[2].id ||
          results[0].id === results[2].id
        ) {
          const s =
            results[0].id === results[1].id
              ? results[0]
              : results[1].id === results[2].id
                ? results[1]
                : results[2];
          payout = bet * s.payout;
        }
        const net = payout - bet;
        applyResult(net, bet);
        document.getElementById("slots-result").innerText =
          `${results.map((s) => s.id).join(" ")} â†’ Payout ${payout} (Net ${net.toFixed(2)})`;
        message("Slots done!");
      }

      // ---- Save management ----
      function exportSave() {
        const blob = new Blob([JSON.stringify(player, null, 2)], {
          type: "application/json",
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "player_save.json";
        a.click();
        URL.revokeObjectURL(url);
      }

      function importSave(e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = () => {
          try {
            player = { ...DEFAULT_PLAYER, ...JSON.parse(reader.result) };
            savePlayer();
            updateInfo();
            message("Save imported");
          } catch {
            message("Invalid save file");
          }
        };
        reader.readAsText(file);
      }

      function resetSave() {
        player = { ...DEFAULT_PLAYER };
        savePlayer();
        updateInfo();
        message("Save reset");
      }

      updateInfo();
    </script>
  </body>
</html>
